<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CompareVCFs &#8212; CompareVCFs 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CompareVCFs 0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for CompareVCFs</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">vcf</span>
<span class="kn">from</span> <span class="nn">vcf</span> <span class="k">import</span> <span class="n">utils</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">intervaltree</span> <span class="k">import</span> <span class="n">IntervalTree</span>
<span class="kn">from</span> <span class="nn">fuzzywuzzy</span> <span class="k">import</span> <span class="n">process</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>


<div class="viewcode-block" id="Genes"><a class="viewcode-back" href="../index.html#CompareVCFs.Genes">[docs]</a><span class="k">class</span> <span class="nc">Genes</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The features class stores genes taken from a gff file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gff</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        :param gff: the file name of the gff file you want to import</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gene_dict</span> <span class="o">=</span> <span class="n">gff</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Genes.get_name"><a class="viewcode-back" href="../index.html#CompareVCFs.Genes.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        import</span>
<span class="sd">        :param info:</span>
<span class="sd">        :return: Either the name of the Gene or the Orf number</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Gene.+?;&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Name.+?;&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gene_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        :return: gene_dict</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gene_dict</span>

    <span class="nd">@gene_dict</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">gene_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gff</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets the the features to a range tree of genes</span>
<span class="sd">        :param gff:</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">gd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">gff</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gene&quot;</span><span class="p">):</span>
                    <span class="n">gd</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">IntervalTree</span><span class="p">())</span>
                    <span class="n">gd</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">])]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gene_dict</span> <span class="o">=</span> <span class="n">gd</span></div>


<div class="viewcode-block" id="Child"><a class="viewcode-back" href="../index.html#CompareVCFs.Child">[docs]</a><span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        :param call: The genotype data from the vcf</span>
<span class="sd">        :param name: The name of the hild</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">sample</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutation</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">al</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">gt_bases</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gt</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">gt_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gt_data</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">effect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#TODO</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Name:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; Allele:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">al</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Genotype:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; MutationType:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mutation</span><span class="p">)</span></div>


<div class="viewcode-block" id="Row"><a class="viewcode-back" href="../index.html#CompareVCFs.Row">[docs]</a><span class="k">class</span> <span class="nc">Row</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">features</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">parent_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare_children</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">extract_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        :param file_name:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">start_index</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">end_index</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file_name</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The name of the gene that contains this position.</span>
<span class="sd">        :return: the gene that that contains this position. Returns a null string if the position is intergenic.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">gene</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">chrom</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">feature</span><span class="p">:</span>
            <span class="n">gene</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">pop</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">gene</span>

    <span class="k">def</span> <span class="nf">compare_no_null</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        compares the child if both the child and parent vary from the reference</span>
<span class="sd">        :param child:</span>
<span class="sd">        :return: str: hom, het or loh</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">gt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">gt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;hom&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;het&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">gt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">gt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;het&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;loh&quot;</span>
        <span class="k">return</span> <span class="n">mut</span>

    <span class="k">def</span> <span class="nf">compare_null_child</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        compares the child if the child is homozygeous to the reference but the parent is not</span>
<span class="sd">        :return: str: hom or loh</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">gt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;hom&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;loh&quot;</span>
        <span class="k">return</span> <span class="n">mut</span>

    <span class="k">def</span> <span class="nf">compare_null_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        compares the child if the parent is homozygeous to the reference but the child is not</span>
<span class="sd">        :param child:</span>
<span class="sd">        :return: str: hom or het</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">gt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;hom&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mut</span> <span class="o">=</span> <span class="s2">&quot;het&quot;</span>
        <span class="k">return</span> <span class="n">mut</span>

    <span class="k">def</span> <span class="nf">compare_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        determines the each child&#39;s mutation type and adds it to the child instance</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">and</span> <span class="n">child</span><span class="p">:</span>
                <span class="n">mut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_no_null</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">child</span><span class="p">:</span>
                <span class="n">mut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_null_child</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">and</span> <span class="n">child</span><span class="p">:</span>
                <span class="n">mut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare_null_parent</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">mutation</span> <span class="o">=</span> <span class="n">mut</span></div>


<div class="viewcode-block" id="MultiSampleRow"><a class="viewcode-back" href="../index.html#CompareVCFs.MultiSampleRow">[docs]</a><span class="k">class</span> <span class="nc">MultiSampleRow</span><span class="p">(</span><span class="n">Row</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The multisample row represents a row taken from a vcf with multiple sample per file.</span>
<span class="sd">        :param recs:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Row</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#if not raw_data[0].FILTER:</span>
        <span class="c1">#    self.make_children(parent=parent_call_name)</span>

    <span class="k">def</span> <span class="nf">make_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        :param parent:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="MultiFileRow"><a class="viewcode-back" href="../index.html#CompareVCFs.MultiFileRow">[docs]</a><span class="k">class</span> <span class="nc">MultiFileRow</span><span class="p">(</span><span class="n">Row</span><span class="p">):</span>
    <span class="n">parent_index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Represents a row created from multiple vcfs</span>
<span class="sd">        :param recs:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">Row</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">recs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_index</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">recs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_index</span><span class="p">]</span><span class="o">.</span><span class="n">FILTER</span><span class="p">:</span>
            <span class="n">parent_rec</span> <span class="o">=</span> <span class="n">recs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_index</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">Child</span><span class="p">(</span><span class="n">parent_rec</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">parent_rec</span><span class="o">.</span><span class="n">POS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="n">parent_rec</span><span class="o">.</span><span class="n">CHROM</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_children</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">recs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_index</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_children</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a Child() for each child in the row.</span>
<span class="sd">        :param recs:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">recs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rec</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_index</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Child</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="n">idx</span><span class="p">])))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">POS</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chrom</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">CHROM</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">REF</span></div>


<div class="viewcode-block" id="VCFWriter"><a class="viewcode-back" href="../index.html#CompareVCFs.VCFWriter">[docs]</a><span class="k">class</span> <span class="nc">VCFWriter</span><span class="p">():</span>

    <span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">readers</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">readers</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Writes the data to a vcf</span>
<span class="sd">        :param file_names:</span>
<span class="sd">        :param readers:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outfiles</span> <span class="o">=</span> <span class="p">[</span><span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.comparevcf.vcf&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writers</span> <span class="o">=</span> <span class="p">[</span><span class="n">vcf</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">readers</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span>
                        <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfiles</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes all the files</span>
<span class="sd">        :param exc_type:</span>
<span class="sd">        :param exc_val:</span>
<span class="sd">        :param exc_tb:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outfiles</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        writes a Row() to the vcf</span>
<span class="sd">        :param row:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">formatted_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">formatted_row</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writers</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">write_record</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">format_row</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param row:</span>
<span class="sd">        :return: a list of PyVCF Record objects. There is a different record for every child.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_recs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">mutation</span><span class="p">:</span>
                <span class="n">alt</span> <span class="o">=</span> <span class="p">[</span><span class="n">vcf</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_Substitution</span><span class="p">([</span><span class="n">child</span><span class="o">.</span><span class="n">al</span><span class="p">])]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                    <span class="n">ref</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">ref</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ref</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">al</span>

                <span class="n">new_rec</span><span class="o">=</span><span class="n">vcf</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_Record</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;PASS&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="n">call</span> <span class="o">=</span> <span class="n">vcf</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_Call</span><span class="p">(</span><span class="n">new_rec</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">gt_data</span><span class="p">)</span>

                <span class="n">new_rec</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">call</span><span class="p">]</span>
                <span class="nb">print</span> <span class="n">new_rec</span><span class="o">.</span><span class="n">ALT</span>
                <span class="n">new_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_rec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_recs</span></div>


<div class="viewcode-block" id="CSVWriter"><a class="viewcode-back" href="../index.html#CompareVCFs.CSVWriter">[docs]</a><span class="k">class</span> <span class="nc">CSVWriter</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the data to a csv file</span>
<span class="sd">        :param outfile:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Row</span><span class="o">.</span><span class="n">file_names</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.comparevcf.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">csv_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        closes the outfile</span>
<span class="sd">        :param exc_type:</span>
<span class="sd">        :param exc_val:</span>
<span class="sd">        :param exc_tb:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">row</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        :param row:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">formatted_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">formatted_rows</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">format_row</span><span class="p">(</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a list of lists. Where each list represents the csv row for a child.</span>
<span class="sd">        :param row:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">formatted_rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">mutation</span><span class="p">:</span>
                <span class="n">csv_row</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">parent_name</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">chrom</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">gene</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">mutation</span><span class="p">]</span>
                <span class="n">formatted_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">csv_row</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">formatted_rows</span></div>


<span class="k">class</span> <span class="nc">Comparator</span><span class="p">():</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">        Abstract class that iterates through all the VCF and generates Rows</span>
<span class="sd">        :param args:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infiles</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">infiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">infiles</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_location</span><span class="p">(</span><span class="n">vcf</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes all the files</span>
<span class="sd">        :param exc_type:</span>
<span class="sd">        :param exc_value:</span>
<span class="sd">        :param traceback:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Uses an index to select only a portion of the genome</span>
<span class="sd">        :param reader:</span>
<span class="sd">        :return: a new reader that one contains a specific portion of the genome</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">adjusted_reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">:</span>
            <span class="n">loc_chr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">adjusted_reader</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">loc_chr</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">adjusted_reader</span>


<span class="k">class</span> <span class="nc">MultiSampleComparator</span><span class="p">(</span><span class="n">Comparator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param args:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Comparator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return: a MultiSampleRow()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rec</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">MultiSampleRow</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MultiFileComparator</span><span class="p">(</span><span class="n">Comparator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        :param args:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">Comparator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">walker</span> <span class="o">=</span> <span class="n">vcf</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">walk_together</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">readers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        :return: a Row() creates from the walker&#39;s row</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">recs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">walker</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">MultiFileRow</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row</span>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../index.html#CompareVCFs.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    :return:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Compare one parent vcf to one or more child vcfs. All files should be bgzipped and tabix indexed.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;infiles&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;The locations of all files to be compared.</span>
<span class="s1">                        If only one file is given, the file is assumed to be a multisample vcf.</span>
<span class="s1">                        In this case, specify the call name of the parent. If there are multiple files,</span>
<span class="s1">                        the parent is assumed to be the first, unless a different file name is given by the parent</span>
<span class="s1">                        option.&#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--parent&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The call name or filename of the parent&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--pedigree&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;The relationship between parents and children can also be specified with a</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;     json file of the form:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;    {parent:/file/path/to/parent.vcf,children:[file/path/to/first/child.vcf,file/path/to/second/child.vcf]}&quot;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--location&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;The chromesome, start position and end position that you would like to pull out. For</span>
<span class="s1">                        example: 5 44567 44789. If you specify this option the file must be tabix indexed.&#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--gff&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;Path of GFF for features&#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--csv&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;If you want a vcf output, otherwise will be a csv&#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--outfile&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;Name of the outfile. By default the outfile is the name of the parent followed by the</span>
<span class="s1">                        extension&#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/cwf08523/PycharmProjects/CompareVCFs/test_data/&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;SC5314_parental_trimmed_sorted_rmdup_realigned.bam.gatk.vcf.gz&quot;</span><span class="p">,</span>
                              <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;aleeza1_trimmed_sorted_rmdup_realigned.bam.gatk.vcf.gz&quot;</span><span class="p">,</span>
                              <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;aleeza3_trimmed_sorted_rmdup_realigned.bam.gatk.vcf.gz&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;--parent&quot;</span><span class="p">,</span> <span class="s2">&quot;SC5314&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;--gff&quot;</span><span class="p">,</span>
                              <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;C_albicans_SC5314_version_A21-s02-m09-r08_features_with_chromosome_sequences.gff&quot;</span><span class="p">,</span>
                              <span class="p">])</span>

    <span class="n">Row</span><span class="o">.</span><span class="n">parent_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">parent</span>

    <span class="n">Row</span><span class="o">.</span><span class="n">file_names</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">infiles</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">gff</span><span class="p">:</span>
        <span class="n">feat</span> <span class="o">=</span> <span class="n">Genes</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">gff</span><span class="p">)</span>
        <span class="n">Row</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">gene_dict</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">infiles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">MultiFileRow</span><span class="o">.</span><span class="n">parent_index</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">infiles</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">extractOne</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">infiles</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">MultiFileRow</span><span class="o">.</span><span class="n">file_names</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">infiles</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">MultiFileComparator</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">MultiSampleComparator</span>

    <span class="k">with</span> <span class="n">comp</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="k">as</span> <span class="n">cp</span><span class="p">:</span>
        <span class="k">pass</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">csv</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">CSVWriter</span>
            <span class="n">writer_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">outfile</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">VCFWriter</span>
            <span class="n">writer_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">infiles</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">readers</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">writer</span><span class="p">(</span><span class="o">*</span><span class="n">writer_args</span><span class="p">)</span> <span class="k">as</span> <span class="n">wr</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cp</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">compare_children</span><span class="p">()</span>
                <span class="n">wr</span><span class="o">.</span><span class="n">write_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></div>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Curtis Focht.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
    </div>

    

    
  </body>
</html>